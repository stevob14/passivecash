<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Live Bitcoin (BTC) and Ethereum (ETH) price tickers and historical charts with linear regression analysis from PassiveCash.xyz.">
    <title>Crypto Tickers & Charts - PassiveCash.xyz</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q203YEXP0D"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-Q203YEXP0D');
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
             <a href="index.html" class="logo">PassiveCash.xyz</a>
             <!-- Hamburger Button -->
             <button id="hamburger-btn" aria-label="Toggle Navigation Menu" aria-expanded="false">
                 <span class="bar"></span>
                 <span class="bar"></span>
                 <span class="bar"></span>
             </button>
             <!-- Navigation Links -->
            <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="calculators.html">Calculators</a></li>
                <li><a href="crypto.html" class="active">Crypto</a></li>
                <li><a href="market.html">Market</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="disclaimer.html">Disclaimer</a></li>
            </ul>
        </div>
    </nav>

    <!-- Advertisement Bar -->
    <div id="advertisement"></div>

    <div class="content-container">
        <div id="crypto-selector-container">
            <button id="crypto-menu-trigger">Bitcoin (BTC)</button> <!-- Trigger Button -->
            <div id="crypto-menu"> <!-- Dropdown Menu -->
                <button class="crypto-option" data-target="btc-section" data-display="Bitcoin (BTC)">Bitcoin (BTC)</button>
                <button class="crypto-option" data-target="eth-section" data-display="Ethereum (ETH)">Ethereum (ETH)</button>
                <button class="crypto-option" data-target="sol-section" data-display="Solana (SOL)">Solana (SOL)</button>
            </div>
        </div>

<div id="btc-section" class="crypto-section crypto-content active">
    <!-- Removed H2 Title -->
    <span class="BtcPrice"></span> <!-- Use unique class -->
    <p>Bitcoin is the first decentralized cryptocurrency that consists of peer-to-peer transactions that are verified and recorded in a public blockchain. What is unique about Bitcoin is the ability to act as a currency outside the control of any person, group, or entity. Get free Bitcoin worth $20 by signing up at <a href="https://coinbase.com/join/MG2TWZF">Coinbase-Referral</a>.</p>
    <div id="chart" class="chart-container"></div> <!-- Target for btc_chart.js -->
</div>

<div id="eth-section" class="crypto-section crypto-content">
    <!-- Removed H2 Title -->
    <span class="EthPrice"></span> <!-- Use unique class -->
    <p>Ethereum is the first decentralized blockchain network that can run smart contracts and is powered by the ETH cryptocurrency. Smart contracts are applications that run exactly as programmed without any chance of censorship, fraud or third-party interference. What makes this unique is the ability of developers to build custom smart contracts for various applications using the Ethereum network. For example, <a href="/index.html#crypto-interest">DeFi</a> applications built using the Ethereum network.</p>
    <div id="chart-eth" class="chart-container"></div> <!-- Use unique ID -->
</div>

<div id="sol-section" class="crypto-section crypto-content">
    <!-- Placeholder Title/Content -->
    <span class="SolPrice"></span> <!-- Use unique class -->
    <p>Solana is a high-performance blockchain supporting builders around the world creating crypto apps that scale today. It is known for its speed and low transaction costs.</p>
    <div id="chart-sol" class="chart-container"></div> <!-- Use unique ID -->
</div>

    </div>

    <!-- Include jQuery and Highstock (for charts) -->
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/highstock.js"></script>
    <!-- Include Crypto JS files -->
    <script src="js/linear_regression.js"></script> <!-- Uncommented and moved up -->
    <script src="js/ticker.js"></script> <!-- Unified ticker script -->
    <script src="js/chart.js"></script>  <!-- Unified chart script -->
    <!-- Removed old btc/eth specific ticker and chart scripts -->

    <script>
        // Define baseTitle and updatePageTitle globally BEFORE document.ready
        const baseTitle = document.title; // Store base title globally

        // --- Function to update page title --- (Now Global)
        // Accepts cryptoType directly
        function updatePageTitle(cryptoType, price) {
            // console.log(`updatePageTitle called: cryptoType=${cryptoType}, price=${price}, baseTitle=${baseTitle}`); // DEBUG LOG removed
            if (price && cryptoType) {
                const formattedPrice = parseFloat(price).toLocaleString('en-US', { style: 'currency', currency: 'USD' });
                const newTitle = `${cryptoType.toUpperCase()} ${formattedPrice} - PassiveCash.xyz`;
                // console.log(`Setting title to: ${newTitle}`); // DEBUG LOG removed
                document.title = newTitle;
            } else {
                // console.log(`Resetting title to baseTitle: ${baseTitle}`); // DEBUG LOG removed
                document.title = baseTitle; // Reset on error or missing info
            }
        }

        // Placeholder for potential page-specific initialization if needed
        $(document).ready(function() {
            console.log("Crypto page loaded.");
            let activePriceIntervalId = null; // Variable to hold the active interval ID
            // baseTitle is now global
            // --- Function to start/switch the active price ticker ---
            function startTicker(cryptoType) {
                console.log("Starting ticker for:", cryptoType); // Debug log
                // Clear any existing interval
                if (activePriceIntervalId) {
                    clearInterval(activePriceIntervalId);
                    activePriceIntervalId = null;
                    console.log("Cleared previous interval"); // Debug log
                }

                // Determine the correct price element selector based on cryptoType
                let priceSelector;
                if (cryptoType === 'btc') {
                    priceSelector = '.BtcPrice';
                } else if (cryptoType === 'eth') {
                    priceSelector = '.EthPrice';
                } else if (cryptoType === 'sol') {
                    priceSelector = '.SolPrice';
                } else {
                     console.error("Cannot determine priceSelector in startTicker for:", cryptoType);
                     return; // Don't proceed if type is unknown
                }

                // Use the unified ticker function, passing the selector
                get_crypto_price(cryptoType, priceSelector); // Call once immediately
                activePriceIntervalId = setInterval(() => get_crypto_price(cryptoType, priceSelector), 1000); // Set interval
                console.log(`Started ${cryptoType.toUpperCase()} interval:`, activePriceIntervalId); // Debug log
            }

            // --- Custom Dropdown Logic ---
            const cryptoMenuTrigger = $('#crypto-menu-trigger');
            const cryptoMenu = $('#crypto-menu');
            const cryptoOptions = $('#crypto-menu .crypto-option'); // Buttons within the menu
            const cryptoSections = $('.crypto-content'); // The content sections (btc-section, eth-section)

            // Toggle dropdown visibility
            cryptoMenuTrigger.on('click', function(e) {
                e.stopPropagation(); // Prevent click from immediately closing menu
                cryptoMenu.toggleClass('active');
            });

            // --- Function to show a specific section ---
            function showSection(targetId, updateHistory = true) {
                const targetSection = $('#' + targetId);
                const targetOption = cryptoOptions.filter(`[data-target="${targetId}"]`);

                if (!targetSection.length) { return; } // Exit if target doesn't exist

                // Derive cryptoType from targetId (e.g., "sol-section" -> "sol")
                const cryptoType = targetId.replace('-section', '');
                // Define valid types for safety check
                const validTypes = ['btc', 'eth', 'sol'];
                if (!validTypes.includes(cryptoType)) {
                     console.error("Could not derive valid cryptoType from targetId:", targetId);
                     return;
                }

                // Derive chartContainerId (special case for btc)
                const chartContainerId = (cryptoType === 'btc') ? 'chart' : `chart-${cryptoType}`;

                // Update trigger button text
                if (targetOption.length && cryptoMenuTrigger.text() !== targetOption.data('display')) {
                    cryptoMenuTrigger.text(targetOption.data('display'));
                }

                // Hide other sections and show the target
                const currentActiveSection = $('.crypto-content.active');
                if (currentActiveSection.attr('id') !== targetId) {
                   currentActiveSection.removeClass('active');
                   targetSection.addClass('active');
                }

                // Initialize chart only if it hasn't been initialized yet
                // We use a data attribute on the section to track initialization
                if (targetSection.data('chart-initialized') !== true) {
                    console.log(`Initializing chart for ${cryptoType} in #${chartContainerId}`);
                    // Ensure the container exists before creating chart
                    if ($(`#${chartContainerId}`).length) {
                         create_crypto_chart(cryptoType, chartContainerId);
                         targetSection.data('chart-initialized', true); // Mark as initialized
                    } else {
                         console.error(`Chart container #${chartContainerId} not found!`);
                    }
                } else {
                     console.log(`Chart for ${cryptoType} already initialized.`);
                     // Optional: Reflow existing chart if needed after being hidden/shown
                     // This requires finding the specific chart instance. Highcharts stores them
                     // in Highcharts.charts array, but finding the right one can be tricky.
                     // A simpler way might be to store the chart instance on the element itself.
                     // Or, if reflow isn't strictly necessary, just skip it.
                     // Example using Highcharts.charts (less reliable if charts are destroyed/recreated):
                     // const chartInstance = Highcharts.charts.find(c => c && c.renderTo.id === chartContainerId);
                     // if (chartInstance) {
                     //     chartInstance.reflow();
                     // }
                }

                // Always start/restart the ticker for the selected section
                startTicker(cryptoType);

                // Update URL hash if requested and different
                const currentHash = window.location.hash;
                const newHash = '#' + cryptoType;
                if (updateHistory && currentHash !== newHash) {
                    if (history.pushState) {
                        history.pushState(null, null, newHash);
                    } else {
                        window.location.hash = newHash; // Fallback
                    }
                }
            }

            // Handle option selection from dropdown
            cryptoOptions.on('click', function() {
                const targetId = $(this).data('target');
                cryptoMenu.removeClass('active'); // Hide menu
                showSection(targetId, true); // Show section and update history
            });

            // Close dropdown if clicking outside
            $(document).on('click', function(e) {
                if (!cryptoMenu.is(e.target) && cryptoMenu.has(e.target).length === 0 && !cryptoMenuTrigger.is(e.target)) {
                    cryptoMenu.removeClass('active');
                }
            });

            // --- Handle Hash on Page Load and Back/Forward ---
            function handleHashChange() {
                const hash = window.location.hash; // e.g., "#sol"
                const validTypes = ['btc', 'eth', 'sol']; // Keep this list updated
                let cryptoType = 'btc'; // Default

                if (hash && hash.length > 1) {
                    const potentialType = hash.substring(1); // Remove '#' -> "sol"
                    if (validTypes.includes(potentialType)) {
                        cryptoType = potentialType;
                    } else {
                         console.warn(`Invalid hash detected: ${hash}. Defaulting to BTC.`);
                    }
                }

                // Construct targetId directly
                const targetId = `${cryptoType}-section`;

                showSection(targetId, false); // Show section without updating history again
            }

            // Listen for hash changes (back/forward buttons)
            $(window).on('hashchange', handleHashChange);

            // Initial page load check
            handleHashChange();

            // Chart initialization would happen here or be triggered by the ticker scripts if needed
            // let btcChart, ethChart; // Define chart variables if needed for reflow
        });
    </script>

    <!-- Hamburger Menu Script -->
    <script>
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const navLinks = document.getElementById('nav-links');

        hamburgerBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            // Optional: Toggle ARIA attribute for accessibility
            const isExpanded = navLinks.classList.contains('active');
            hamburgerBtn.setAttribute('aria-expanded', isExpanded);
        });
    </script>

    <!-- Advertisement Script -->
    <script src="js/advertisement.js"></script>

</body>
</html>
